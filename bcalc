#!/bin/bash
## A calculator in pure-bash.
## I even made a pure-bash lexer for this.
## Not gonna lie I feel pretty accomplished right now.
## ---------------------------------------------------
## Created by: Phate6660 [https://github.com/Phate6660]
## Dependencies: Only bash ;)

# Get the first arg (since that's all we need), and add a space betweem each character.
args="$1"
for ((i=0; i<${#args}; i++)); do
    args_spaces+="${args:$i:1} "
done

# Read each space-separated character into the array.
# shellcheck disable=SC2162
read -a args_array <<< "$args_spaces"

# Iterate over the argument array.
# TODO: Figure out how to create appropriately titled variables on demand.
# I feel as though that would be the best way to solve the problem of
# having a hardcoded amount of numbers and operators in the script.
for i in "${args_array[@]}"; do
    # Check if "$i" is a number, and if so...
    if [[ "$i" =~ ^[0-9]+$ ]]; then
        # If "$op" is set...
        if [ -n "$op" ]; then
            # If "$op" is set, append to "$n3_array" and continue the for loop.
            if [ -n "$op2" ]; then
                n3_array+=("$i")
                continue
            # Else append to "$n2_array" and continue the for loop.
            else 
                n2_array+=("$i")
                continue
            fi
        else
            # Else append the number to "$n1_array" and continue the for loop.
            n1_array+=("$i")
            continue
        fi
    fi
    # Check if "$i" is a math operation...
    if [ "$i" == "*" ] || [ "$i" == "/" ] || [ "$i" == "+" ] || [ "$i" == "-" ]; then
        # If "$op" is set, set "$op2" to the math operation found and continue the for loop.
        if [ -n "$op" ]; then
            op2="$i"
            continue
        # Else set "$op" to the math operation found and continue the for loop.
        else 
            op="$i"
            continue
        fi
    fi
done

# The _pre variables contain all the elements of the respective number arrays.
# Then {n1,n2} are the contents of the _pre variables with the spaces removed.
n1_pre="${n1_array[*]}"
n1="${n1_pre// /}"
n2_pre="${n2_array[*]}"
n2="${n2_pre// /}"
# Check the the 3rd number array was creating by checking it's first indexed element.
if [ -n "${n3_array[0]}" ]; then
    n3_pre="${n3_array[*]}"
    n3="${n3_pre// /}"
fi

if [ -n "$n3" ]; then
    echo $(("$n1" "$op" "$n2" "$op2" "$n3"))
else
    echo $(("$n1" "$op" "$n2"))
fi
